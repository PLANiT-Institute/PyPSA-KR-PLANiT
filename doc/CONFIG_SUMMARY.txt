================================================================================
PyPSA CONFIGURATION SYSTEM - COMPREHENSIVE DOCUMENTATION
================================================================================

DOCUMENTATION FILES CREATED:
1. CONFIG_SYSTEM_DOCUMENTATION.md (30 KB) - Complete detailed guide
2. CONFIG_QUICK_REFERENCE.md (12 KB) - Quick lookup reference
3. CONFIG_SUMMARY.txt (this file) - Executive summary

================================================================================
CONFIGURATION SECTIONS OVERVIEW
================================================================================

11 Main Configuration Sections:

1. carrier_mapping
   Location: config root
   Purpose: Maps diverse fuel type names to standardized carriers
   When used: Final step before optimization
   Example: bituminous → coal, LNG → gas

2. generator_attributes
   Location: config root
   Purpose: Sets operational constraints per carrier type
   When used: After carrier standardization
   Example: coal → p_min_pu=0.4, p_max_pu=1.0

3. global_constraints
   Location: config root
   Purpose: System-wide generation limits per carrier
   When used: Not yet active (prepared for future use)
   Example: gas → max_cf=1.0

4. cc_merge_rules
   Location: config root
   Purpose: Defines how to merge multi-unit generators
   When used: Early in workflow
   Rules: oldest, newest, sum, mean, p_nom, cc_group, remove
   Example: p_nom=sum, build_year=oldest

5. generator_region_aggregator_rules
   Location: config root
   Purpose: Aggregates generators by (carrier, region) combination
   When used: Regional workflows only
   Result format: {carrier}_{region} (e.g., "coal_경기")

6. regional_aggregation
   Location: config root
   Purpose: Controls network aggregation by geography
   When used: Regional analysis workflows
   Contains: Lines/links aggregation rules, generator aggregation flag

7. monthly_data
   Location: config root
   Purpose: Path to monthly time-series data file
   File format: CSV with snapshot, carrier, attribute, value columns
   Aggregation levels: national, province, generator

8. snapshot_data
   Location: config root
   Purpose: Path to snapshot-level (hourly) time-series data
   File format: CSV with snapshot, carrier, attribute, value columns
   Frequency: Hourly or more frequent

9. Base_year
   Location: config root
   Purpose: Network base data location and year
   Contents: year (integer), file_path (string to CSV folder)

10. Years
    Location: config root
    Purpose: List of modeling years
    When used: Multi-year analysis (not yet implemented)

11. regional_settings
    Location: config root
    Purpose: Regional parameters (e.g., national_region="KR")
    Used throughout: Data loading, aggregation, optimization

================================================================================
WORKFLOW COMPARISON
================================================================================

Single-Node Workflow:
1. Load configuration
2. Load network (all components connect to "KR" bus)
3. Merge CC generators (uses cc_merge_rules)
4. Apply monthly data (uses original carrier names)
5. Apply snapshot data (uses original carrier names)
6. Standardize carrier names (applies carrier_mapping) - FINAL STEP
7. Apply generator attributes (per carrier after standardization)
8. Optimize

Regional Workflow:
1. Load configuration
2. Load network (multiple buses per province)
3. Merge CC generators
4. Apply monthly data
5. Apply snapshot data
6. Aggregate network by region:
   - Create regional buses
   - Map generators to regional buses
   - Aggregate lines by region pairs
   - Aggregate links by region pairs
   - Optionally aggregate generators by carrier+region
   - Create regional loads from demand file
7. Standardize carrier names (FINAL STEP)
8. Apply generator attributes
9. Optimize

KEY INSIGHT: Carrier standardization is always the final step before applying
generator attributes and optimization. This allows data loading to use original
carrier names (matching data files) while final network uses standardized names.

================================================================================
CC MERGE RULES - Available Rules
================================================================================

Rule          | Operation      | Use Case
--------------+----------------+----------------------------------------
oldest        | min()          | For years, dates, minimum values
smallest      | min()          | Alias for oldest
newest        | max()          | For years, dates, maximum values
largest       | max()          | Alias for newest
sum           | sum()          | For capacities, costs to accumulate
mean          | mean()          | For efficiencies, averages
p_nom         | from largest    | Use value from biggest generator
cc_group      | identity        | Use the cc_group value itself
remove        | skip            | Don't include in merged generator

Example application:
  Input: 2 generators with cc_group="Plant_A"
    - GT_Unit: p_nom=100 MW, build_year=2010, efficiency=0.35
    - ST_Unit: p_nom=50 MW, build_year=2015, efficiency=0.30
  
  Rules:
    p_nom: sum → 150 MW
    build_year: oldest → 2010
    efficiency: mean → 0.325
  
  Output: Plant_A_CC with merged attributes

================================================================================
REGIONAL AGGREGATION - Line Rules
================================================================================

When aggregating transmission lines by region pairs:

grouping:
  - by_voltage: Group by (region0, region1, voltage) - keeps voltages separate
  - ignore_voltage: Group by (region0, region1) - combines all voltages

circuits (parallel lines):
  - sum: Sum all parallel circuits (most common)
  - max: Use maximum circuits
  - mean: Use average circuits

s_nom (power rating):
  - keep_original: Use from one line (tracked via circuits)
  - sum: Sum all s_nom values
  - max: Use maximum
  - scale_by_circuits: Scale by circuit count

impedance (r, x, b):
  - weighted_by_circuits: Weighted average by circuit count (most accurate)
  - mean: Simple average
  - min: Use minimum
  - max: Use maximum

length:
  - mean: Average length
  - max: Maximum length
  - min: Minimum length

remove_self_loops:
  - true: Remove lines within same region
  - false: Keep all lines

================================================================================
GENERATOR ATTRIBUTES - Available Options
================================================================================

Attribute        | Type  | Range | Description
-----------------+-------+-------+----------------------------------------
p_min_pu         | float | 0-1   | Technical minimum output (% of capacity)
p_max_pu         | float | 0-1   | Maximum output (% of capacity)
max_cf           | float | 0-1   | Maximum capacity factor (average over time)
efficiency       | float | 0-1   | Conversion efficiency
marginal_cost    | float | any   | Variable cost per MWh
capital_cost     | float | any   | Fixed cost per MW of capacity

Example by technology:
  - Gas: p_min_pu=0.2 (flexible, quick start)
  - Coal: p_min_pu=0.4 (slower, higher minimum)
  - Nuclear: p_min_pu=0.6 (baseload plant)
  - Wind: max_cf=0.35 (capacity factor limit)
  - Solar: max_cf=0.25 (lower capacity factor)

================================================================================
REGIONAL AGGREGATION - Generator Rules
================================================================================

When aggregating generators by (carrier, region):

Rule         | Operation        | Use Case
-------------+------------------+----------------------------------------
carrier      | Keep as-is       | For carrier attribute
region       | Use region value | For regional attributes
p_nom        | from largest     | For capacity-based attributes
oldest       | min()            | For minimum values
newest       | max()            | For maximum values
sum          | sum()            | For total capacities
mean         | mean()           | For averages (efficiency, costs)
remove/ignore| skip            | Don't include this attribute
Fixed value  | literal value     | e.g., control: PQ

Example:
  Aggregating 5 coal generators in region "경기":
  - carrier: coal (all generators) → coal
  - region: 경기 (all generators) → 경기
  - bus: region → 경기 (map to regional bus)
  - p_nom: sum → total capacity
  - marginal_cost: mean → average cost
  
  Result: Single generator named "coal_경기"

================================================================================
DATA FILES - Format Specification
================================================================================

monthly_data.csv Structure:
  snapshot | carrier | components | components_t | attribute | value | status | region | aggregation
  2024-01-01 | LNG | generators | generators_t | fuel_cost | 50000 | TRUE | KR | national

snapshot_data.csv Structure:
  Same as monthly_data but with hourly timestamps:
  2024-01-01 00:00 | wind | generators | generators_t | p_max_pu | 0.8 | TRUE | KR | national

Columns:
  - snapshot: Date/time (first day of month for monthly, hourly for snapshot)
  - carrier: Original carrier name (BEFORE mapping - this is important!)
  - components: PyPSA table name (generators, loads, storage_units, etc.)
  - components_t: Time-series table name (generators_t, loads_t, etc.)
  - attribute: Column name to set (fuel_cost, p_max_pu, efficiency, etc.)
  - value: Numeric value to apply
  - status: TRUE to apply this row, FALSE to skip
  - region: Region name (KR for national, or province name)
  - aggregation: "national", "province", or "generator" aggregation level

Aggregation levels:
  - national: Apply to all generators matching region="KR"
  - province: Apply by matching generator's region/province
  - generator: Apply by matching generator name

================================================================================
KEY FUNCTIONS BY MODULE
================================================================================

libs/config.py:
  - load_config(config_path) - Load YAML or Excel config file

libs/data_loader.py:
  - load_network(config) - Load PyPSA network from CSV
  - load_monthly_data(config) - Load monthly time-series
  - load_snapshot_data(config) - Load snapshot time-series

libs/cost_mapping.py:
  - standardize_carrier_names(network, carrier_mapping) - Apply carrier mapping
  - apply_generator_attributes(network, attributes) - Set gen limits per carrier
  - apply_monthly_data_to_network(network, config, data) - Apply monthly data
  - apply_snapshot_data_to_network(network, config, data) - Apply snapshot data

libs/cc_merger.py:
  - merge_cc_generators(network, config) - Merge CC units using rules

libs/region_aggregator.py:
  - aggregate_network_by_region(network, config) - Regional aggregation

libs/aggregators.py:
  - aggregate_generators_by_carrier_and_region() - Aggregate gens by region

libs/bus_mapper.py:
  - map_buses(network, config, mapping_type) - Map components to buses

================================================================================
IMPORTANT NOTES
================================================================================

1. CARRIER NAMING CRITICAL ORDERING:
   - Data files use ORIGINAL carrier names
   - Keep original names during data loading
   - Standardize names at the FINAL step before optimization
   - Apply generator_attributes AFTER standardization
   
   This ensures:
   - Data loading uses correct original names
   - Final network is clean and consistent
   - No name mismatches between data and network

2. REGIONAL AGGREGATION REQUIREMENTS:
   - region_column must exist in buses, generators, loads CSVs
   - demand_file must have columns: [region_column, 'demand']
   - province_mapping_file (if provided) maps long names to short names
   
3. CC MERGE REQUIREMENT:
   - cc_group column must exist in generators.csv
   - Empty strings are handled (converted to NaN)
   - Creates merged generator named "{cc_group}_CC"

4. DATA FILE REQUIREMENTS:
   - snapshot column must be valid datetime
   - carrier column must match original names (before mapping)
   - status column TRUE to apply, FALSE to skip
   - aggregation level must match region_column

5. GENERATOR ATTRIBUTES:
   - Applied PER CARRIER to ALL matching generators
   - Applied AFTER carrier standardization
   - Overrides values from network loading

================================================================================
FILE LOCATIONS
================================================================================

Created documentation files:
  /Users/sanghyun/github/pypsa_alternative/CONFIG_SYSTEM_DOCUMENTATION.md
  /Users/sanghyun/github/pypsa_alternative/CONFIG_QUICK_REFERENCE.md
  /Users/sanghyun/github/pypsa_alternative/CONFIG_SUMMARY.txt

Example configuration files:
  /Users/sanghyun/github/pypsa_alternative/config/config_single.yaml
  /Users/sanghyun/github/pypsa_alternative/config/config_province.yaml
  /Users/sanghyun/github/pypsa_alternative/config/config_single.xlsx

Source code files:
  /Users/sanghyun/github/pypsa_alternative/libs/config.py
  /Users/sanghyun/github/pypsa_alternative/libs/data_loader.py
  /Users/sanghyun/github/pypsa_alternative/libs/cost_mapping.py
  /Users/sanghyun/github/pypsa_alternative/libs/cc_merger.py
  /Users/sanghyun/github/pypsa_alternative/libs/region_aggregator.py
  /Users/sanghyun/github/pypsa_alternative/libs/aggregators.py
  /Users/sanghyun/github/pypsa_alternative/libs/bus_mapper.py

Main workflows:
  /Users/sanghyun/github/pypsa_alternative/main_singlenode.py
  /Users/sanghyun/github/pypsa_alternative/main_region.py

================================================================================
END OF SUMMARY
================================================================================
